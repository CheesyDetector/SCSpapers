
## 现存问题
- 智能合约验证（合约源码验证/字节码验证）是指将一个地址上存的字节码与用户提供源码的编译结果对应
- 以太坊智能合约验证通过区块链浏览器Etherscan和Blockscout，还有官方平台Sourcify
- 目前验证器的可信赖程度和安全性都得不到保障

## 贡献
- 第一个总结以太坊智能合约验证服务的设计和实现
- 在验证服务中发现了8个被忽视但可被利用的漏洞类型隐藏
- 提出了检测、利用和缓解这些类型漏洞的具体方法，并揭示了隐藏在三个验证器中的19个漏洞。截至撰写本文时，已确认15个漏洞，其中10个已及时修补
- 未发现的漏洞可能会对以太坊生态系统产生极端的负面影响。如数以千万的合约会被攻击者滥用，数以百计的合约已经被操纵了

## 核心部分
### 攻击模型
1. 敌对验证（A1）
   
   利用验证器的漏洞，构造虚假的合约源码，在其他人部署合约字节码完成验证
2. 源欺骗（A2）
   
   攻击者也为合约部署者，但是故意提供虚假的源码完成验证
   
### 验证架构
1. 不可信源码数据采集模块（M1）
   
   源代码文件（有可能有多个文件，Solidity编译器solc允许多个源码文件和路径打包进一个JSON文件），配置项，一个地址
2. 链上数据采集模块（M2）
   
   根据M1中的地址，获取Runtime Code或Bytecode（Bytecode包括Runtime Code和Constructor Code）
3. 编译模块（M3）

   根据M1的配置项编译M1的源码文件，得到字节码。但是编译形成的Runtime code和链上的Runtime code有一些区别，有一些参数需要实际链上信息才能确定

   因此有两个方案解决这个问题：
   - 1）记住所有编译形成的Runtime code中immutable variables的偏移量，并将其视为空白；将链上Runtime code对应偏移量的内容填进空白，直接确保二者immutable variables一致，但这不能做到完全验证的功能
   - 2）获取当时链上信息模拟执行Bytecode
4. 比对模块（M4）

   比对时一般要删除metadata，Blockscout采用一种方法，更改影响metadata的配置项信息，保持运行逻辑不变，通过观察bytecode中变化的部分来识别metadata
5. 数据存储模块（M5）

   完成比对后存储数据
6. 展示&API模块（M6）

   用户请求时响应

### 安全特征
1. 不可恢复性P1
   
   避免用字节码反汇编得到的源码直接通过验证

2. 一致性P2

   保证链上内容和用户上传内容的语义一致性

### 漏洞详情

